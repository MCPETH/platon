import sys
import numpy as np
import time
import scipy.linalg
import matplotlib.pyplot as plt

def get_dl(heights, Nh):
    h_mesh, h_prime_mesh = np.meshgrid(heights, heights)
    h_mesh = np.hstack((h_mesh[:,1:], np.zeros((Nh+1, 1))))
    lengths = 2*np.sqrt(h_prime_mesh**2 - h_mesh**2)

    shifted_lengths = np.vstack((lengths[1:], np.zeros(Nh + 1)))
    dl = lengths - shifted_lengths
    dl[np.isnan(dl)] = 0
    return dl[0:Nh, 0:Nh]

NLam = 4616
Nh = 334

heights = np.loadtxt(sys.argv[1])
assert(len(heights) == Nh + 1)

kappa = np.loadtxt(sys.argv[2])
tau_ref = np.loadtxt(sys.argv[3])

start = time.time()


dl = get_dl(heights, Nh)


result = np.dot(kappa, dl)
print time.time() - start
print np.allclose(result, tau_ref)
